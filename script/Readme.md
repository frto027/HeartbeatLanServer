# 心率LAN协议设计

本软件使用UDP协议在局域网播报心率数据，支持多心率设备、多数据接收端的数据播报

当前协议版本号为001。

# 接收端

接收端用于接收心率数据。

（接收广播即配对）接收端使用UDP协议监听9965端口，如果接收到内容为`HeartBeatSenderHere001`（不含终止0）的UDP广播包，则记下这个包的源ip和端口号，这是发送端的ip和端口。此时已经可以视为配对成功。

> 获得发送端IP和端口后，建议关闭9965的监听，不要复用这个udp端口进行后续通信。这样设备上的其它接收端也能完成匹配。

（发送心跳，就能收到数据）接收端启动一个UDP socket向发送端的ip、端口发送一个内容为`HeartBeatRecHere001`的UDP包（不含终止0）。监听这个socket，在接下来的一段时间内，发送端会发回传感器数据包，数据包格式见下文。

```
[name(string)] 0 [ble mac address(string)] 0 [heart(int32, big endian)]
```

数据实时转发自心率设备，发送频率与心率设备一致。

# 发送端

发送端是一个运行在安卓手机上的UDP服务器。

- 如果app启用了广播，则向255.255.255.255:9965广播`HeartBeatSenderHere001`。
- 持续监听udp数据，如果收到`HeartBeatRecHere001`，则记下数据包来源的接收端和时间。如果已记录过，就更新时间。
- 每当蓝牙传感器数据到达，使用UDP向所有已记录的接收端转发这个数据。
- 清除时间超过一分钟的接收端。